<!DOCTYPE html>
<html>
<head>
	<title>Versus War - Dashboard</title>
        <link rel="shortcut icon" href="../assets/login/images/default.png">
        <link rel="icon" type="image/png" href="assets/login/images/default.png"/>
        <link rel="stylesheet" type="text/css" href="assets/login/vendor/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="assets/login/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="assets/login/vendor/animate/animate.css">
        <link rel="stylesheet" type="text/css" href="assets/login/vendor/css-hamburgers/hamburgers.min.css">
        <link rel="stylesheet" type="text/css" href="assets/login/vendor/select2/select2.min.css">
        <link rel="stylesheet" type="text/css" href="assets/login/css/util.css">
        <link rel="stylesheet" type="text/css" href="assets/login/css/main.css">
        <link href="../assets/plugins/morris/morris.css" rel="stylesheet">
        <link href="../assets/plugins/alertify/css/alertify.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/icons.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/style.css" rel="stylesheet" type="text/css">
        <link href="../assets/plugins/prism/prism.css" rel="stylesheet" type="text/css">
        <link href="../assets/plugins/ion-rangeslider/ion.rangeSlider.css" rel="stylesheet" type="text/css"/>
        <link href="../assets/plugins/ion-rangeslider/ion.rangeSlider.skinModern.css" rel="stylesheet" type="text/css"/>
        <link href="../assets/plugins/bootstrap-rating/bootstrap-rating.css" rel="stylesheet" type="text/css">
        <link href="../assets/plugins/fullcalendar/css/fullcalendar.min.css" rel="stylesheet" />
        <link href="../assets/plugins/c3/c3.min.css" rel="stylesheet" type="text/css"  />
        <link rel="stylesheet" href="../assets/plugins/chartist/css/chartist.min.css">
        <link href="../assets/plugins/timepicker/tempusdominus-bootstrap-4.css" rel="stylesheet" />
        <link href="../assets/plugins/timepicker/bootstrap-material-datetimepicker.css" rel="stylesheet">
        <link href="../assets/plugins/clockpicker/jquery-clockpicker.min.css" rel="stylesheet" />
        <link href="../assets/plugins/colorpicker/asColorPicker.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/select2/select2.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet">
        <link href="../assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet">
        <link href="../assets/plugins/bootstrap-touchspin/css/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
        <link href="../assets/plugins/summernote/summernote-bs4.css" rel="stylesheet" />
        <link href="../assets/plugins/dropzone/dist/dropzone.css" rel="stylesheet" type="text/css">
        <link href="../assets/plugins/dropify/css/dropify.min.css" rel="stylesheet">
        <link type="text/css" href="../assets/plugins/x-editable/css/bootstrap-editable.css" rel="stylesheet">
        <link href="../assets/plugins/jvectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet">
        <link href="../assets/plugins/sweet-alert2/sweetalert2.min.css" rel="stylesheet" type="text/css">
        <link href="../assets/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/RWD-Table-Patterns/dist/css/rwd-table.min.css" rel="stylesheet" type="text/css" media="screen">
</head>

<body class="fixed-left">
<!-- Loader -->
<div id="preloader"><div id="status"><div class="spinner"></div></div></div>

<!-- Begin page -->
<div id="wrapper">
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
<button type="button" class="button-menu-mobile button-menu-mobile-topbar open-left waves-effect">
<i class="ion-close"></i>
</button>

<!-- LOGO -->
<div class="topbar-left">
<div class="text-center">
<a href="index.html" class="logo"><i class="mdi mdi-assistant"></i> Versus War</a>
</div>
</div>

<div class="sidebar-inner slimscrollleft">

<div id="sidebar-menu">
<ul>
<li class="menu-title">Main</li>

<li>
<a href="index.html" class="waves-effect">
<i class="mdi mdi-airplay"></i>
<span> Dashboard </span>
</a>
</li>

<li class="has_sub">
<a href="javascript:void(0);" class="waves-effect"><i class="mdi mdi-cards-playing-outline"></i> <span> Category </span> <span class="float-right"><i class="mdi mdi-chevron-right"></i></span></a>
<ul class="list-unstyled">
<li><a href="addcategory.html">Add Category</a></li>
<li><a href="categories.html">Manage Categories</a></li>
</ul>
</li>

<li class="has_sub">
<a href="javascript:void(0);" class="waves-effect"><i class="mdi mdi-account-box"></i> <span> Profiles </span> <span class="float-right"><i class="mdi mdi-chevron-right"></i></span></a>
<ul class="list-unstyled">
<li><a href="addprofile.html">Add Profile</a></li>
<li><a href="profiles.html">Manage Profiles</a></li>
</ul>
</li>

<li class="has_sub">
<a href="javascript:void(0);" class="waves-effect"><i class="mdi mdi-chemical-weapon"></i> <span> Wars </span> <span class="float-right"><i class="mdi mdi-chevron-right"></i></span></a>
<ul class="list-unstyled">
<li><a href="addwar.html">Create War</a></li>
<li><a href="wars.html">Manage Wars</a></li>
</ul>
</li>

<li class="has_sub">
<a href="javascript:void(0);" class="waves-effect"><i class="mdi mdi-poll"></i> <span> Poll Wars </span> <span class="float-right"><i class="mdi mdi-chevron-right"></i></span></a>
<ul class="list-unstyled">
<li><a href="addpollwar.html">Create War</a></li>
<li><a href="pollwars.html">Manage Wars</a></li>
</ul>
</li>

<li>
<a href="warsuggestions.html" class="waves-effect">
<i class="mdi mdi-checkbox-multiple-marked-circle-outline"></i>
<span> War Suggestions </span>
</a>
</li>

<li>
<a href="feedback.html" class="waves-effect">
<i class="mdi mdi-message-text"></i>
<span> Feedbacks </span>
</a>
</li>

</ul>
</div>
<div class="clearfix"></div>
</div> <!-- end sidebarinner -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
<div class="content">
<!-- Top Bar Start -->
<div class="topbar" id="topMenu">

</div>
<!-- Top Bar End -->
<div class="page-content-wrapper ">
<div class="container-fluid">
<!-- page title start -->
<div class="row">
<div class="col-sm-12">
<div class="page-title-box">
<h4 class="page-title">Update Profile</h4>
</div>
</div>
</div>
<!-- end page title -->
<!-- dashboard content -->
<div class="row">
<div class="col-12">
<div class="card m-b-30">
<div class="card-body">
<h4 class="mt-0 header-title">Fill out the form</h4><br>			
<form onsubmit="updateProfile();return false;">
<div class="form-group row">
<label for="example-text-input" class="col-sm-2 col-form-label">Name</label>
<div class="col-sm-6">
<input class="form-control" type="text" name="name" placeholder="Profile Name" value="" id="profileName" required>
</div>
</div>
<div class="form-group row" hidden="">
<label for="example-text-input" class="col-sm-2 col-form-label">Category</label>
<div class="col-sm-6">
<select class="form-control" id="categoryList" required disabled="">
    <option value="">Select Category</option>
</select>
</div>
</div>
<div class="form-group row">
<label for="example-text-input" class="col-sm-2 col-form-label">2nd Category</label>
<div class="col-sm-6">
<select class="form-control" id="categoryList2">
    <option value="">Select 2nd Category</option>
</select>
</div>
</div>
<div class="form-group row">
<label for="example-text-input" class="col-sm-2 col-form-label">Description</label>
<div class="col-sm-6">
<textarea class="form-control" type="text" placeholder="Short Description about Profile" rows="5" value="" id="profileDescription" required>
</textarea>
</div>
</div>
<div class="form-group row">
<label for="example-text-input" class="col-sm-2 col-form-label">Profile Photo</label>
<div class="col-sm-6">
<input id="profilePhoto" type="file" accept="image/x-png,image/png,image/jpeg" required>
</div>
</div>
<div class="form-group">
<label for="example-time-input" class="col-sm-2 col-form-label" ></label>
<div class="col-sm-10">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button type="submit" id="submitBtn" class="btn btn-primary waves-effect waves-light">Update Profile</button>
<button type="reset" class="btn btn-secondary waves-effect m-l-5">Reset Form</button>
</div>
</div>
</form>
</div>
</div>
</div> <!-- end col -->
</div> <!-- end row -->

<!-- dashboard content end-->
<footer class="footer" id="footer">
Â© 2020 Versus War All Right Reserved.
</footer>
</div>
<!-- End main content here -->
</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/popper.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/modernizr.min.js"></script>
<script src="../assets/js/detect.js"></script>
<script src="../assets/js/fastclick.js"></script>
<script src="../assets/js/jquery.slimscroll.js"></script>
<script src="../assets/js/jquery.blockUI.js"></script>
<script src="../assets/js/waves.js"></script>
<script src="../assets/js/jquery.nicescroll.js"></script>
<script src="../assets/js/jquery.scrollTo.min.js"></script>
<script src="../assets/plugins/alertify/js/alertify.js"></script>
<script src="../assets/pages/alertify-init.js"></script>
<!-- Required datatable js -->
<script src="../assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatables/dataTables.bootstrap4.min.js"></script>
<!-- Buttons examples -->
<script src="../assets/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables/jszip.min.js"></script>
<script src="../assets/plugins/datatables/pdfmake.min.js"></script>
<script src="../assets/plugins/datatables/vfs_fonts.js"></script>
<script src="../assets/plugins/datatables/buttons.html5.min.js"></script>
<script src="../assets/plugins/datatables/buttons.print.min.js"></script>
<script src="../assets/plugins/datatables/buttons.colVis.min.js"></script>
<!-- Datatable init js -->
<script src="../assets/pages/datatables.init.js"></script>
<!-- Sweet-Alert  -->
<script src="../assets/plugins/sweet-alert2/sweetalert2.min.js"></script>
<script src="../assets/pages/sweet-alert.init.js"></script> 
<!-- Bootstrap inputmask js -->
<script src="../assets/plugins/bootstrap-inputmask/bootstrap-inputmask.min.js" type="text/javascript"></script>
<script src="../assets/plugins/skycons/skycons.min.js"></script>
<script src="../assets/plugins/raphael/raphael-min.js"></script>
<script src="../assets/plugins/morris/morris.min.js"></script>
<script src="../assets/pages/dashborad.js"></script>
<!-- App js -->
<script src="../assets/js/app.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>

<script src="../assets/login/js/main.js"></script>
<script >
    $('.js-tilt').tilt({
            scale: 1.1
    })
</script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-23581568-13');
</script>
<script>
 /* BEGIN SVG WEATHER ICON */
 if (typeof Skycons !== 'undefined'){
var icons = new Skycons(
    {"color": "#fff"},
    {"resizeClear": true}
    ),
        list  = [
            "clear-day", "clear-night", "partly-cloudy-day",
            "partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
            "fog"
        ],
        i;

    for(i = list.length; i--; )
    icons.set(list[i], list[i]);
    icons.play();
};

// scroll

$(document).ready(function() {
$("#boxscroll").niceScroll({cursorborder:"",cursorcolor:"#cecece",boxzoom:true});
$("#boxscroll2").niceScroll({cursorborder:"",cursorcolor:"#cecece",boxzoom:true}); 
});
</script>
<!-- end login scripts -->
</body>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-storage.js"></script>
<script type="text/javascript" src="../assets/firebase.js"></script>
<script type="text/javascript" src="../assets/externalHTML.js"></script>
<script type="text/javascript">
	//loadHeader();
	//loadSideMenu();
	loadTopMenu();
	//loadFooter();

    var uid = sessionStorage.getItem("adminUID");
    if(uid==null){
        window.location.href="../index.html";
    }else{
        var profileName = document.getElementById('profileName');
        var categoryName = document.getElementById('categoryList');
        var category2 = document.getElementById('categoryList2');
        var profileDescription = document.getElementById('profileDescription');
        var docID = getUrlParameter('docID');

        db.collection('categories').get().then(async function(snapshot){
            await snapshot.forEach((doc)=>{
                if(doc.exists){
                    var docData = doc.data();
                    $('#categoryList').append(
                        '<option value="'+doc.id+'">'+docData.category+'</option>'
                    );
                    $('#categoryList2').append(
                        '<option value="'+doc.id+'">'+docData.category+'</option>'
                    );
                }else{
                    alert("No Category Found! Add New Category Now!");
                    window.location.href="addcategory.html";
                }
            })
        });

        db.collection('profiles').doc(docID).get().then(async function(doc){
            var data = doc.data();
            profileName.value = data.profileName;
            categoryName.value = data.category;
            category2.value = data.secondCategory;
            profileDescription.value = data.description;

            // await db.collection('categories').doc(data.category).get().then(function(doc){
            //     var oneData = doc.data();
            //     doc.ref.update({
            //         'profiles': oneData.profiles - 1,
            //     })
            // });

            await db.collection('categories').doc(data.secondCategory).get().then(function(doc){
                var twoData = doc.data();
                doc.ref.update({
                    'profiles': twoData.profiles - 1,
                })
            });
        });
    }

    async function updateProfile(){
        $('#submitBtn').html('Updating Profile...').addClass('disabled');
    	var profileName = document.getElementById('profileName').value;
        var categoryName = document.getElementById('categoryList').value;
        var category2 = document.getElementById('categoryList2').value;
        var profileDescription = document.getElementById('profileDescription').value;
        var profilePhoto = document.getElementById('profilePhoto').files[0];
        var docID = getUrlParameter('docID');

        var fileExtension = profilePhoto.name.split('.')[1];

        await db.collection("profiles").doc(docID).update({
            'profileName':profileName,
            'category':categoryName,
            'description':profileDescription,
            'secondCategory':category2,
        })
        .then(async function(doc){

            await storage.ref('profiles/'+docID+'/profilePhoto.'+fileExtension).put(profilePhoto);
            
            await storage.ref('profiles/'+docID+'/profilePhoto.'+fileExtension).getDownloadURL().then(async function(photoURL){
                
                await db.collection("profiles").doc(docID).update({
                    'photoURL': photoURL,
                });

                if(category2!="None"){
                    await db.collection("categories").doc(category2).get().then(function(doc){
                    if(doc.exists){
                        var data = doc.data();
                        doc.ref.update({
                            'profiles': data.profiles + 1,
                        });      
                    }
                    });
                    // .then(async ()=>{
                    //     await db.collection("categories").doc(categoryName).get().then(function(doc){
                    //     if(doc.exists){
                    //     var data = doc.data();
                    //     doc.ref.update({
                    //         'profiles': data.profiles + 1,
                    //     });      
                    //     }
                    //     })
                    // });
                }
            });
            alert("Profile Updated");
            window.location.href="profiles.html";
        });
    }
</script>
</html>
